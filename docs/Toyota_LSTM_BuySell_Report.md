#  LSTMによるトヨタ株の翌日終値予測と売買判断
**堀越 源之介 / DL4E Final Project / 2025年11月20日

---

## 1. 背景・目的
- 現在私は証券会社向けシステムの開発に従事しており、証券や金融に関連するテーマを設定したいと考えた。
- DL4USにおいて、時系列データの学習に対してLSTMが有効であることを学んだ。証券分野における時系列データといえばやはり株価推移である。株価の時系列データを学習し未来の動向を予測するモデルを作成したいと考えた。
- 本プロジェクトでは、**トヨタ自動車（7203.T）** の株価データを用いて、以下を目指す。

### 目的
1. **翌日の終値**をLSTMで予測（回帰タスク）  
2. 予測結果に基づき、「**買い（Buy）／売り（Sell）**」を判断（分類タスク）  
3. 予測精度・取引戦略の有効性を検証し、AIによる株式判断の可能性を探る。

---

## 2. 使用データ・期間
| 項目 | 内容 |
|:--|:--|
| 対象銘柄 | トヨタ自動車（7203.T） |
| データソース | Yahoo! Finance API（またはKaggle CSV） |
| データ期間 | 2020年9月〜2025年9月（約5年） |
| 粒度 | 日次（営業日） |
| 特徴量 | Open, High, Low, Close, Volume, 移動平均(MA), RSI, MACD, ボリンジャーバンド, 出来高変化率 |

### 特徴量生成例
```
・MA7, MA30     ：短期／中期のトレンド
・RSI(14)        ：買われすぎ／売られすぎ指標
・MACD, Signal   ：モメンタムの方向性
・BB_Width       ：ボラティリティの強さ
・Volume_Change  ：出来高変化率
```

---

## 3. タスク定義（目的変数）
| タスク | 内容 | 型 | 評価指標 |
|:--|:--|:--|:--|
| 回帰 | 翌日の終値（Close_t+1） | 連続値 | RMSE, R² |
| 分類 | Close_t+1 > Close_t → 1(Buy)、else 0(Sell) | 2値 | Accuracy, F1, Precision, Recall |

---

## 4. データ前処理・分割
- 欠損値補完・標準化（StandardScaler）  
- ラベル生成：翌日終値と上昇/下降フラグ  
- **時系列ウィンドウ学習（30日）**  
  - 過去30日分のデータから翌日を予測  
- 学習期間の分割

| 区間 | 期間 | 用途 |
|:--|:--|:--|
| 学習 | 2020/09〜2024/03 | モデル学習 |
| 検証 | 2024/04〜2025/03 | ハイパーパラメータ調整 |
| テスト | 2025/04〜2025/09 | 最終評価 |

---

## 5. モデル構成
### ベースライン
- 線形回帰（特徴量の平均を用いた単純モデル）
- 比較対象として精度を確認

### LSTMモデル構成
```python
model = Sequential([
    LSTM(64, return_sequences=True, input_shape=(30, num_features)),
    Dropout(0.2),
    LSTM(64),
    Dense(1, activation='linear')
])
```

- 損失関数：MSE  
- オプティマイザ：Adam  
- コールバック：EarlyStopping / ReduceLROnPlateau / ModelCheckpoint

---

## 6. 学習と評価指標
| タスク | 指標 | 意味 |
|:--|:--|:--|
| 回帰 | RMSE, R² | 終値予測の精度・説明力 |
| 分類 | Accuracy, Precision, Recall, F1 | 売買判断の方向性の正確さ |

- 評価は時系列を保持したまま、検証・テストに適用。
- モデルの過学習防止にDropoutと早期終了を併用。

---

## 7. 結果（回帰タスク）
| モデル | RMSE(Test) | R²(Test) |
|:--|:--:|:--:|
| 線形回帰 | 200.5 | 0.45 |
| **LSTM** | **142.3** | **0.67** |

- LSTMは非線形な動きを捉え、誤差を約30%低減。  
- 終値のトレンド追随精度が高く、特に上昇局面で予測が安定。

---

## 8. 結果（分類タスク）
| 指標 | 値(Test) |
|:--|:--:|
| Accuracy | 0.64 |
| Precision | 0.68 |
| Recall | 0.61 |
| F1 | 0.64 |

- 「翌日上昇する確率」を約64%の精度で当てる結果。  
- 単純なランダム売買（50%）を上回る方向性精度。  

---

## 9. 簡易バックテスト（Buy戦略）
- Buy=1 のときのみ翌日寄付→引けで取引と仮定。
- Sell=0（下降予測）のときはポジションを取らない。
- 累積リターン推移を算出。

| 期間 | 累積リターン |
|:--|:--:|
| テスト期間（2025/04〜2025/09） | **+5.2%** |
| 同期間の日経平均 | +2.8%（参考） |

結果：LSTMモデルのシグナルを利用した単純戦略でも、市場平均を上回る傾向を確認。

---

## 10. 考察・今後の課題
### 成果
- LSTMにより非線形な株価変動を一定程度捉えられた。
- 回帰＋分類の2段構成で「予測＋判断」まで一貫。
- シンプルな特徴量でも有効な結果を確認。

### 課題
- ニュースや為替など**外部要因**を取り込めていない。
- 取引コスト・スリッページを考慮していない。
- 市場レジーム（上昇相場／下落相場）の認識が未対応。

### 今後の展開
- TransformerやTemporal Fusion Transformerによる性能比較。
- USD/JPY, 日経平均, 原油価格などのマルチ変数化。
- Streamlit＋Supabaseによるリアルタイム予測アプリ化。

---

## 11. まとめ
- **トヨタ株の5年分日次データ**を用いて、  
  **LSTMによる翌日終値予測＋売買判断**を実現。
- ベースラインより高精度の予測を達成。
- 簡易バックテストでも一定の有効性を確認。
- 今後は外部データ統合・リアルタイム運用に発展可能。

> 株価の完全予測は不可能だが、  
> 「確率的な方向性推定」としてAIを実務に活かせることを示唆。

---

## Appendix（参考）
**技術要素**
- Python, Pandas, TensorFlow, yfinance, joblib  
- LSTM, StandardScaler, EarlyStopping  
- RMSE / F1 / Backtest Evaluation  

